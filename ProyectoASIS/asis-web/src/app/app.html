@if (authService.isAuthenticated()) {
  <div class="min-h-screen bg-gray-50 d-flex">
    <!-- Sidebar con el diseño del inicio -->
    <div class="sidebar-nav bg-dark text-white p-4" style="width: 256px; min-height: 100vh; position: fixed; top: 0; left: 0; z-index: 1000;">
      <div class="mb-4">
        <div class="d-flex align-items-center mb-3">
          <a routerLink="/inicio" class="d-flex align-items-center text-decoration-none cursor-pointer">
            <img src="assets/logo/favicon-32x32.png" alt="ASIS Logo" class="me-2" style="height: 32px; width: 32px;">
            <h1 class="h5 mb-0 fw-bold text-white">Sistema ASIS</h1>
          </a>
        </div>
        <p class="small text-light opacity-75 mb-0">Centro de Salud Universitario</p>
        @if (authService.currentUser()) {
          <p class="small text-light opacity-75 mt-2">
            Bienvenido, {{ authService.currentUser()?.nombre || authService.currentUser()?.nombreUsuario }}
          </p>
        }
      </div>

      <nav class="nav-sections">
        @if (authService.currentUser()?.perfil === 'ADMINISTRADOR') {
          <!-- Sección Usuarios (Solo Admin) -->
          <div class="mb-2">
            <button 
              (click)="toggleUsuariosMenu()"
              class="w-100 d-flex align-items-center justify-content-between p-3 btn rounded sidebar-btn"
              [class.sidebar-btn-active]="isUsuariosRoute()">
              <div class="d-flex align-items-center">
                <i class="bi bi-people me-2"></i>
                <span>Usuarios</span>
              </div>
              <i class="bi" [class.bi-chevron-down]="isUsuariosMenuOpen()" 
                 [class.bi-chevron-right]="!isUsuariosMenuOpen()"></i>
            </button>
            <div class="ms-3 mt-2" *ngIf="isUsuariosMenuOpen()">
              <a routerLink="/usuarios" 
                 routerLinkActive="sidebar-sub-btn-active"
                 class="w-100 text-start p-2 btn btn-link text-light sidebar-sub-btn d-block text-decoration-none">
                <i class="bi bi-people me-2"></i>
                Todos los Usuarios
              </a>
              <a routerLink="/usuarios-pendientes" 
                 routerLinkActive="sidebar-sub-btn-active"
                 class="w-100 text-start p-2 btn btn-link text-light sidebar-sub-btn d-block text-decoration-none">
                <i class="bi bi-person-exclamation me-2"></i>
                Usuarios Pendientes
              </a>
            </div>
          </div>
        }

        <!-- Otros elementos del menú -->
        @if (authService.currentUser()?.perfil !== 'REFERENTE_ORG_SOCIAL') {
          <a routerLink="/estadisticas" 
             routerLinkActive="sidebar-main-btn-active"
             class="w-100 d-flex align-items-center p-3 btn btn-link text-light sidebar-main-btn mb-2 text-decoration-none">
            <i class="bi bi-bar-chart me-2"></i>
            <span>Estadísticas</span>
          </a>
        }

        <a routerLink="/reportes" 
           routerLinkActive="sidebar-main-btn-active"
           class="w-100 d-flex align-items-center p-3 btn btn-link text-light sidebar-main-btn mb-2 text-decoration-none">
          <i class="bi bi-file-text me-2"></i>
          <span>Reportes</span>
        </a>

        @if (authService.currentUser()?.perfil !== 'REFERENTE_ORG_SOCIAL') {
          <a routerLink="/mapa" 
             routerLinkActive="sidebar-main-btn-active"
             class="w-100 d-flex align-items-center p-3 btn btn-link text-light sidebar-main-btn mb-2 text-decoration-none">
            <i class="bi bi-geo-alt me-2"></i>
            <span>Mapa</span>
          </a>
        }

        @if (authService.currentUser()?.perfil !== 'REFERENTE_ORG_SOCIAL') {
          <div class="mb-2">
            <button 
              (click)="toggleAbmlMenu()"
              class="w-100 d-flex align-items-center justify-content-between p-3 btn rounded sidebar-btn"
              [class.sidebar-btn-active]="isAbmlRoute()">
              <div class="d-flex align-items-center">
                <i class="bi bi-gear me-2"></i>
                <span>Control</span>
              </div>
              <i class="bi" [class.bi-chevron-down]="isAbmlMenuOpen()" 
                 [class.bi-chevron-right]="!isAbmlMenuOpen()"></i>
            </button>
            <div class="ms-3 mt-2" *ngIf="isAbmlMenuOpen()">
              <a routerLink="/campanias" 
                 routerLinkActive="sidebar-sub-btn-active"
                 class="w-100 text-start p-2 btn btn-link text-light sidebar-sub-btn d-block text-decoration-none">
                <i class="bi bi-clipboard-data me-2"></i>
                Campañas
              </a>
              <a routerLink="/jornadas" 
                 routerLinkActive="sidebar-sub-btn-active"
                 class="w-100 text-start p-2 btn btn-link text-light sidebar-sub-btn d-block text-decoration-none">
                <i class="bi bi-calendar-event me-2"></i>
                Jornadas
              </a>
              <a routerLink="/barrios" 
                 routerLinkActive="sidebar-sub-btn-active"
                 class="w-100 text-start p-2 btn btn-link text-light sidebar-sub-btn d-block text-decoration-none">
                <i class="bi bi-house me-2"></i>
                Barrios
              </a>
              <a routerLink="/zonas" 
                 routerLinkActive="sidebar-sub-btn-active"
                 class="w-100 text-start p-2 btn btn-link text-light sidebar-sub-btn d-block text-decoration-none">
                <i class="bi bi-map me-2"></i>
                Zonas
              </a>
            </div>
          </div>
}
      </nav>

      <!-- Botón de Perfil y Cerrar Sesión -->
      <div class="position-absolute bottom-0 start-0 end-0 p-4">
        <a routerLink="/perfil" 
           routerLinkActive="sidebar-main-btn-active"
           class="w-100 d-flex align-items-center justify-content-center p-3 btn btn-outline-light mb-2 text-decoration-none">
          <i class="bi bi-person me-2"></i>
          <span>Perfil</span>
        </a>
        <button (click)="logout()" 
                class="w-100 d-flex align-items-center justify-content-center p-3 btn btn-outline-light">
          <i class="bi bi-box-arrow-right me-2"></i>
          <span>Cerrar Sesión</span>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="flex-fill" style="margin-left: 256px;">
      <router-outlet></router-outlet>
    </main>
  </div>
} @else {
  <!-- Solo mostrar el outlet cuando no está autenticado (login) -->
  <router-outlet></router-outlet>
}
