<div class="container-fluid p-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="h3 fw-bold text-dark mb-1">Jornadas</h2>
      <p class="text-muted mb-0">Gestión de jornadas de trabajo de campo</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-primary" (click)="toggleFormularioAlta()">
        <i class="bi bi-plus-circle me-2"></i>
        Crear Jornada
      </button>
      <input type="text" class="form-control" style="width: 250px;" placeholder="Buscar jornada..." 
             [ngModel]="search()" (ngModelChange)="updateSearch($event)">
    </div>
  </div>

  <!-- Formulario de creación -->
  <div *ngIf="mostrarFormularioAlta()" class="card mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0">
        <i class="bi bi-plus-circle me-2"></i>
        Crear Nueva Jornada
      </h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="crearJornada()">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label fw-medium">Fecha de la jornada</label>
            <input type="date" class="form-control" 
                   [ngModel]="nuevaJornada().fecha" 
                   (ngModelChange)="updateNuevaJornadaFecha($event)" 
                   name="fecha" required>
          </div>
          <div class="col-md-4">
            <label class="form-label fw-medium">Campaña</label>
            <select class="form-select" 
                    [ngModel]="nuevaJornada()['campaña']?.id || ''" 
                    (ngModelChange)="updateNuevaJornadaCampania($event)" 
                    name="campania">
              <option value="" disabled>Seleccionar</option>
              <option *ngFor="let campania of campaniaService.campanias()" [value]="campania.id">
                {{ campania.nombre }}
              </option>
            </select>
          </div>
        </div>
        
        <div class="d-flex gap-2 mt-3">
          <button type="submit" class="btn btn-success">
            <i class="bi bi-check-lg me-1"></i>
            Guardar
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelarAlta()">
            <i class="bi bi-x-lg me-1"></i>
            Cancelar
          </button>
        </div>
        
        <!-- Mensaje de confirmación -->
        <div *ngIf="mensajeExito()" class="alert mt-3 mb-0" 
             [ngClass]="mensajeExito().includes('Error') ? 'alert-danger' : 'alert-success'">
          <i [class]="mensajeExito().includes('Error') ? 'bi bi-exclamation-triangle me-2' : 'bi bi-check-circle me-2'"></i>
          {{ mensajeExito() }}
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla de jornadas -->
  <div *ngIf="jornadasFiltradas().length > 0" class="card">
    <div class="card-header bg-light">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Jornadas Registradas ({{ jornadasFiltradas().length }})</h5>
        <div class="text-muted small">
          Página {{ paginaActual() }} de {{ totalPaginas() }} 
          ({{ jornadasPaginadas().length }} de {{ jornadasFiltradas().length }} jornadas)
        </div>
      </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Fecha</th>
              <th scope="col">Campaña</th>
              <th scope="col" class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let jornada of jornadasPaginadas()">
              <!-- Fila normal de la jornada -->
              <tr>
                <td class="fw-medium">#{{ jornada.id }}</td>
                <td>{{ jornada.fecha | date:'dd/MM/yyyy' }}</td>
                <td>
                  <span *ngIf="jornada['campaña']" class="badge bg-secondary">{{ jornada['campaña'].nombre }}</span>
                  <span *ngIf="!jornada['campaña']" class="text-muted">Sin campaña</span>
                </td>
                <td class="text-center">
                  <div class="btn-group btn-group-sm" role="group">
                    <button type="button" 
                            class="btn btn-outline-primary"
                            (click)="editarJornada(jornada)"
                            title="Editar jornada">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button type="button" 
                            class="btn btn-outline-danger"
                            (click)="eliminarJornada(jornada.id)"
                            title="Eliminar jornada">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <!-- Fila del formulario de edición -->
              <tr *ngIf="jornadaEditando() === jornada.id" class="table-secondary">
                <td colspan="4">
                  <div class="p-3">
                    <h6 class="mb-3">
                      <i class="bi bi-pencil me-2"></i>
                      Editar Jornada #{{ jornada.id }}
                    </h6>
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label fw-medium">Fecha de la jornada</label>
                        <input type="date" class="form-control" 
                               [ngModel]="jornadaEditada().fecha" 
                               (ngModelChange)="updateJornadaEditadaFecha($event)" 
                               required>
                      </div>
                      <div class="col-md-4">
                        <label class="form-label fw-medium">Campaña</label>
                        <select class="form-select" 
                                [ngModel]="jornadaEditada()['campaña']?.id || ''" 
                                (ngModelChange)="updateJornadaEditadaCampania($event)" 
                                name="campania">
                          <option value="" disabled>Seleccionar</option>
                          <option *ngFor="let campania of campaniaService.campanias()" [value]="campania.id">
                            {{ campania.nombre }}
                          </option>
                        </select>
                      </div>
                    </div>
                    
                    <div class="d-flex gap-2 mt-3">
                      <button type="button" class="btn btn-success btn-sm" (click)="confirmarEdicion()">
                        <i class="bi bi-check-lg me-1"></i>
                        Confirmar
                      </button>
                      <button type="button" class="btn btn-secondary btn-sm" (click)="cancelarEdicion()">
                        <i class="bi bi-x-lg me-1"></i>
                        Cancelar
                      </button>
                    </div>
                    
                    <!-- Mensaje de validación dentro del formulario de edición -->
                    <div *ngIf="mensajeEdicion()" class="alert mt-3 mb-0" 
                         [ngClass]="mensajeEdicion().includes('Error') ? 'alert-danger' : 'alert-success'">
                      <i [class]="mensajeEdicion().includes('Error') ? 'bi bi-exclamation-triangle me-2' : 'bi bi-check-circle me-2'"></i>
                      {{ mensajeEdicion() }}
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Controles de paginación -->
    <div class="card-footer bg-light" *ngIf="totalPaginas() > 1">
      <nav aria-label="Navegación de páginas">
        <ul class="pagination justify-content-center mb-0">
          <!-- Botón anterior -->
          <li class="page-item" [class.disabled]="paginaActual() === 1">
            <button class="page-link" (click)="paginaAnterior()" [disabled]="paginaActual() === 1">
              <i class="bi bi-chevron-left"></i>
              Anterior
            </button>
          </li>
          
          <!-- Números de página -->
          <li *ngFor="let pagina of paginasArray()" 
              class="page-item" 
              [class.active]="pagina === paginaActual()">
            <button class="page-link" (click)="irAPagina(pagina)">
              {{ pagina }}
            </button>
          </li>
          
          <!-- Botón siguiente -->
          <li class="page-item" [class.disabled]="paginaActual() === totalPaginas()">
            <button class="page-link" (click)="paginaSiguiente()" [disabled]="paginaActual() === totalPaginas()">
              Siguiente
              <i class="bi bi-chevron-right"></i>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <div *ngIf="jornadasFiltradas().length === 0" class="card">
    <div class="card-body text-center py-5">
      <i class="bi bi-calendar-event display-1 text-muted mb-3"></i>
      <h5 class="text-muted">No hay jornadas disponibles</h5>
      <p class="text-muted">Haz clic en "Crear Jornada" para agregar la primera jornada</p>
    </div>
  </div>
</div>
